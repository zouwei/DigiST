# DigiST

> 采用前后端分离结构，来开发DigiST程序，此项目为DigiST服务端程序。
>
> 方面起见，常用的信息都在此文档中进行描述，包含且不限于项目描述、项目接口文档，项目规范等



| 版本编号 | 版本日期   | 修改者 | 说明               |
| -------- | ---------- | ------ | ------------------ |
| v0.0.1   | 2018-12-24 | 邹伟   | 用户相关的接口描述 |



## 1.项目结构描述

~~~

bin:程序启动项，为了服务器进程管理，改成与服务相同的名称（相当于app.js）
common：此目录放置通用的js helper文件
config：配置文件
doc：开发文档以及程序相关的设计文档统一放到这个doc目录下，README.md可以做软链接，如有有需要的话。
handlers:程序处理层，路由方法实现层，桥接底层services业务逻辑处理层。
models：ORM关系对象模型，映射数据表对象，封装常规的CRUD业务
modelsservices：扩展models的方法，抽象出更加通用的底层业务方法，缓存可以封装在这一层来实现，当然也可以用另外的形式来体现，根据业务需要来编排。
services：业务逻辑层，业务逻辑代码写在这一层。

~~~


## 2.项目启动

~~~

1.配置文件配置，需要连接到数据库
2.安装依赖包文件，npm i
3.启动程序，bin\digist.js
4.检查是否启动正常

~~~





##3.项目接口

项目接口遵循一些基本的规则，在使用的过程中，这些基本的规则是全局通用的，例如：host指定为接口访问的域名（包含端口号）。

本项目为例，本地开发环境的host则为：http://localhost:9980，接口API的路由组成完整的API地址：http://localhost:9980/ws_service/user/getCaptcha

在实际的测试环境中或者生产环境中只需要替换api的域名部分即可。

**返回参数code值定义**

| 返回参数值 | 说明                                                    |
| ---------- | ------------------------------------------------------- |
| 0          | 表示请求成功                                            |
| 1          | 表示失败，大于0的都非正常状态，不同的值根据业务单独定义 |





### 3.1获取图形码

页面图形验证码，主要作用是防止对一些付费接口的流量攻击，发送短信是有成本的，通过引入图形验证码能在一定程度上预防这种流量攻击。

| 名称   | 值                            |
| ------ | ----------------------------- |
| API    | `/ws_service/user/getCaptcha` |
| METHOD | get                           |

图形验证码接口是一个GET接口，在前端HTML中的img标签直接指向src即可。

~~~js
// 入参
// 前端缓存需要注意，切换图形验证码的时候，可以在url末尾带一个时间戳
// 例如：/ws_service/user/getCaptcha?ts=14500039390009
~~~





### 3.2发送短信验证码

发送短信验证码，发送短信验证码接口已经一个通用的接口，在多种需要使用短信验证码的场景中使用这一个接口。

| 名称   | 值                                      |
| ------ | --------------------------------------- |
| API    | `/ws_service/user/sendVerificationCode` |
| METHOD | post                                    |

**入参**

~~~js
// 入参
{
    "mobile":"18888888888",		// 手机号码
    "graphVerifyCode":"1234",	// 图形验证码，如果用图形验证码，必传
    "verifyUser":true			// 【可选参数】验证用户：ture表示用户存在才发送短信，false表示用户不存在再发送短信；参数不存在则表示不验证用户
}
      
~~~

**出参**

~~~js
{
    "code": "0",
    "msg": "请求成功",
    "module": "",
    "result": "短信发送成功"
}
~~~



### 3.3用户注册

新用户注册

| 名称   | 值                              |
| ------ | ------------------------------- |
| API    | `/ws_service/user/userRegister` |
| METHOD | post                            |

**入参**

```js
{
    "mobile":"18888888888",				// 手机号码
    "password":"abc0123456789",			// 登录密码
    "verifyCode":"1234"					// 手机验证码
}
```

**出参**

```js
// 出参如果没有需要字段，可以协商增加
{
    "user_id":"4944010064586BF5205C0000",
    "name":"188****8888",
    "created_time":"2018-12-24T15:04:10.892Z"
}
```



### 3.4找回密码

根据手机号码找回密码

| 名称   | 值                                  |
| ------ | ----------------------------------- |
| API    | `/ws_service/user/retrievePassword` |
| METHOD | post                                |

**入参**

```js
{
    "mobile":"18888888888",				// 手机号码
    "password":"abc0123456789",			// 登录密码
    "verifyCode":"1234"					// 手机验证码
}
```

**出参**

```js
// 出参如果没有需要字段，可以协商增加
{
    "user_id":"49440100583A36F61E5C0000",
    "name":"188****8888",
    "mobile":"78888888888"
}
```



### 3.5用户登录

用户登录，根据手机号码登录，暂时没开发邮箱登录，其他登录方式使用同一个API，传入不同的值即可。

| 名称   | 值                           |
| ------ | ---------------------------- |
| API    | `/ws_service/user/userLogin` |
| METHOD | post                         |

**入参**

```js
{
    "mobile":"18888888888",				// 手机号码
    "password":"abc0123456789"   		// 登录密码
}
```

**出参**

```js
{
    "user_id":"49440100583A36F61E5C0000",	// 用户id，绝对唯一
    "name":"188****8888",					// 用户姓名（不唯一，显示使用）
    "mobile":"78888888888",					// 手机号码（登录账户之一，唯一）
    "isSetPassword":true,			// 是否设置了登录密码，false表示未设置
    "isSetPayPassword":true			// 是否设置了支付密码，false表示未设置
}
```



### 3.6修改登录密码

首次登录密码设置可以不同输入旧密码，前端表现只需要个密码框即可，这个状态判断根据登录返回的结果值进行判断。

如果是已经设置过了登录密码，则需要输入旧密码验证通过之后才能修改成功。

| 名称   | 值                                |
| ------ | --------------------------------- |
| API    | `/ws_service/user/changePassword` |
| METHOD | post                              |

**入参**

```js
{
    "user_id":"",                   	// 用户id
    "old_password":"abc0123456789",     // 旧密码，首次设置登录密码，不传参
    "new_password":"abc0123456789"      // 新密码
}
```

**出参**

```js
{
    "user_id":"49440100583A36F61E5C0000",	// 用户id，绝对唯一
    "name":"188****8888",					// 用户姓名（不唯一，显示使用）
    "mobile":"78888888888",					// 手机号码（登录账户之一，唯一）
    "isSetPassword":true,			// 是否设置了登录密码，false表示未设置
    "isSetPayPassword":true			// 是否设置了支付密码，false表示未设置
}
```



### 3.7修改支付密码

首次支付密码设置可以不同输入旧密码，前端表现只需要个密码框即可，这个状态判断根据登录返回的结果值进行判断。

如果是已经设置过了支付密码，则需要输入旧密码验证通过之后才能修改成功。

| 名称   | 值                                   |
| ------ | ------------------------------------ |
| API    | `/ws_service/user/changePayPassword` |
| METHOD | post                                 |

**入参**

```js
{
    "user_id":"",                   		// 用户id
    "old_pay_password":"abc0123456789",     // 旧密码，首次设置支付密码，不传参
    "new_pay_password":"abc0123456789"      // 新密码
}
```

**出参**

```js
{
    "user_id":"49440100583A36F61E5C0000",	// 用户id，绝对唯一
    "name":"188****8888",					// 用户姓名（不唯一，显示使用）
    "mobile":"78888888888",					// 手机号码（登录账户之一，唯一）
    "isSetPassword":true,			// 是否设置了登录密码，false表示未设置
    "isSetPayPassword":true			// 是否设置了支付密码，false表示未设置
}
```























### 3.



| 名称   | 值                  |
| ------ | ------------------- |
| API    | `/ws_service/user/` |
| METHOD | post                |

**入参**

```js

```

**出参**

```js

```

